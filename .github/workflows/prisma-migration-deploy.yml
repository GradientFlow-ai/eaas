name: Prisma Migration Deploy

on: [issue_comment]

jobs:
  migrate:
  if: ${{ github.event.issue.pull_request && contains(github.event.comment.body, 'prisma migrate') }}
  runs-on: ubuntu-latest
   env:
    DATABASE_URL: ${{ secrets.DATABASE_URL }}
    SHADOW_DATABASE_URL: ${{ secrets.SHADOW_DATABASE_URL }}

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Setup Node.js
      uses: actions/setup-node@v2
      with:
        node-version: 16

    - name: Install dependencies
      run: yarn

    - name: Run Prisma migration
      run: npx prisma migrate deploy
